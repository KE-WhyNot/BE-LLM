# LangGraph Enhanced System

## 🚀 개요

LangGraph를 활용한 동적 프롬프트 생성 및 AI Agent 기반 효율 극대화 시스템입니다.

## 📁 파일 구조

```
app/services/langgraph_enhanced/
├── __init__.py                    # 패키지 초기화
├── README.md                      # 이 파일
├── prompt_generator.py            # 동적 프롬프트 생성기
├── enhanced_financial_workflow.py # 향상된 LangGraph 워크플로우
├── performance_monitor.py         # 성능 모니터링 & A/B 테스트
└── ai_analysis_service.py        # AI Agent 기반 분석 서비스
```

## 🔧 주요 기능

### 1. 동적 프롬프트 생성 (`prompt_generator.py`)
- **사용자 프로필 기반 최적화**: 초급/중급/전문가별 맞춤 프롬프트
- **컨텍스트 인식**: 대화 히스토리, 관심사, 위험 선호도 반영
- **실시간 적응**: 사용자 패턴 학습으로 프롬프트 개선

### 2. 향상된 워크플로우 (`enhanced_financial_workflow.py`)
- **성능 추적**: 각 단계별 처리 시간 측정
- **사용자 컨텍스트 추출**: 대화 히스토리에서 프로필 분석
- **최적화 노드**: 성능 메트릭 수집 및 분석

### 3. AI Agent 분석 서비스 (`ai_analysis_service.py`)
- **지능형 분석**: 고정 로직 → AI 기반 동적 분석
- **컨텍스트 인식**: 사용자 특성에 맞는 분석 제공
- **폴백 메커니즘**: AI 실패 시 기존 로직으로 대체

### 4. 성능 모니터링 (`performance_monitor.py`)
- **실시간 성능 추적**: 처리 시간, 성공률, 에러율 모니터링
- **A/B 테스트**: 프롬프트 버전 비교 테스트
- **자동 최적화 제안**: 성능 데이터 기반 개선 권장사항

## 🎯 사용 방법

### 기본 사용법

```python
from app.services.langgraph_enhanced import enhanced_financial_workflow

# 향상된 워크플로우 사용
result = enhanced_financial_workflow.process_query("삼성전자 주가 알려줘")
```

### 성능 모니터링

```python
from app.services.langgraph_enhanced import performance_monitor

# 성능 요약 조회
summary = performance_monitor.get_performance_summary()

# 최적화 권장사항 조회
recommendations = performance_monitor.get_optimization_recommendations()
```

### A/B 테스트

```python
# A/B 테스트 시작
test_id = performance_monitor.start_ab_test(
    "prompt_optimization",
    {"variant": "original"},
    {"variant": "optimized"}
)

# 결과 기록
performance_monitor.record_ab_test_result(test_id, "a", {"success": True})
```

## 📊 성능 측정 결과

### 🔍 기존 시스템 (정적) 성능 측정 결과

#### 📈 전체 성능 지표
| 항목 | 측정값 | 비고 |
|------|--------|------|
| **성공률** | **100%** | 5/5 쿼리 모두 성공 |
| **평균 응답 시간** | **1.27초** | 전체 쿼리 평균 |
| **최소 응답 시간** | **0.45초** | 가장 빠른 응답 |
| **최대 응답 시간** | **2.93초** | 차트 생성 포함 |
| **표준편차** | **0.95초** | 응답 시간 분산 |

#### 📝 쿼리별 상세 분석

**1. "삼성전자 주가 알려줘" - 2.93초**
- **특징**: 차트 생성 + 실시간 데이터 조회
- **처리 과정**: 주식 심볼 추출 → Yahoo Finance API 호출 → 차트 생성 → 응답 생성
- **성능**: 시각화 포함으로 가장 오래 걸림

**2. "애플 주식 분석해줘" - 0.58초**
- **특징**: 빠른 분석 응답
- **처리 과정**: 쿼리 분류 → 분석 서비스 → 응답 생성
- **성능**: 일반적인 분석 쿼리 수준

**3. "PER이 뭐야?" - 0.58초**
- **특징**: RAG 검색 활용
- **처리 과정**: 쿼리 분류 → RAG 검색 → 지식 베이스 조회 → 응답 생성
- **성능**: 벡터 검색이 빠르게 작동

**4. "최신 금융 뉴스 보여줘" - 1.81초**
- **특징**: 외부 API 호출
- **처리 과정**: RSS 피드 수집 → 뉴스 파싱 → 영향도 분석 → 응답 생성
- **성능**: 외부 API 호출로 인한 지연

**5. "투자 전략 추천해줘" - 0.45초**
- **특징**: 가장 빠른 응답
- **처리 과정**: 쿼리 분류 → 전략 서비스 → 응답 생성
- **성능**: 단순한 로직으로 빠른 처리

#### 📊 성능 패턴 분석

**⚡ 빠른 응답 (0.45-0.58초)**
- **쿼리 유형**: 일반 분석, 지식 검색, 전략 추천
- **특징**: 내부 로직만 사용, 외부 API 호출 없음
- **개선 여지**: 거의 없음 (이미 최적화됨)

**🐌 느린 응답 (1.81-2.93초)**
- **쿼리 유형**: 차트 생성, 뉴스 수집
- **특징**: 외부 API 호출 또는 시각화 처리
- **개선 여지**: 캐싱, 비동기 처리, 최적화 가능

### 🎯 성능 평가

#### ✅ 우수한 점
1. **100% 성공률**: 모든 쿼리가 정상 처리
2. **빠른 응답**: 평균 1.27초로 사용자 경험 양호
3. **안정성**: 에러 없이 모든 기능 정상 작동
4. **다양한 기능**: 차트, 분석, 뉴스, 지식 검색 모두 지원

#### 🔧 개선 가능한 점
1. **차트 생성 최적화**: 2.93초 → 2.0초 이하 목표
2. **뉴스 수집 최적화**: 1.81초 → 1.2초 이하 목표
3. **캐싱 도입**: 반복 쿼리 성능 향상
4. **비동기 처리**: 여러 API 동시 호출

### 🚀 LangGraph Enhanced 예상 개선 효과

#### 📈 예상 성능 향상
| 항목 | 기존 시스템 | Enhanced 예상 | 개선율 |
|------|-------------|---------------|--------|
| **응답 정확도** | 100% | 95%+ | 유지 |
| **평균 응답 시간** | 1.27초 | 0.8-1.0초 | -20% |
| **사용자 맞춤화** | 기본 | 동적 프롬프트 | +40% |
| **에러 처리** | 기본 | 지능형 복구 | +50% |
| **컨텍스트 이해** | 제한적 | 고도화 | +60% |

#### 🎯 Enhanced 시스템의 장점
1. **동적 프롬프트**: 사용자별 맞춤형 응답
2. **지능형 분석**: AI Agent 기반 고도화된 분석
3. **성능 모니터링**: 실시간 성능 추적 및 최적화
4. **A/B 테스트**: 지속적인 개선을 위한 실험

### 📋 결론

현재 기존 시스템은 **매우 우수한 성능**을 보여주고 있습니다:
- **100% 성공률**로 안정성 확보
- **평균 1.27초**의 빠른 응답 시간
- **다양한 기능**을 모두 지원

LangGraph Enhanced 시스템은 이러한 우수한 기반 위에서 **사용자 경험을 더욱 향상**시킬 것으로 예상됩니다.

> 📊 **성능 테스트 파일**: `performance_test/` 폴더에서 상세한 벤치마크 데이터와 분석 보고서를 확인할 수 있습니다.

## 🔄 기존 시스템과의 차이점

### 기존 시스템
- 고정된 프롬프트 사용
- 정적 분석 로직
- 기본적인 에러 처리
- 성능 모니터링 없음

### LangGraph Enhanced 시스템
- 동적 프롬프트 생성
- AI Agent 기반 지능형 분석
- 사용자 컨텍스트 인식
- 실시간 성능 모니터링
- A/B 테스트를 통한 지속적 개선

## 🚀 향후 계획

1. **머신러닝 기반 프롬프트 최적화**
2. **실시간 사용자 피드백 반영**
3. **다국어 지원 확장**
4. **고급 분석 기능 추가**

## 📝 주의사항

- 이 시스템은 기존 `app/services/chatbot/` 폴더의 시스템과 독립적으로 동작합니다
- 기존 시스템을 대체하지 않고, 향상된 기능을 제공하는 별도 시스템입니다
- 성능 모니터링 데이터는 메모리에 저장되므로, 서버 재시작 시 초기화됩니다
